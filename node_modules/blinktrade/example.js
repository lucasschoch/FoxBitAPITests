const { BlinkTradeWS } = require('./src')

const brokerId = 8999999

function processWithdraw({
  data,
  reason,
  reasonId,
  fixedFee,
  percentFee,
  action: Action,
  withdrawId: WithdrawID,
}) {
  const msg = {
    MsgType: MsgTypes.WITHDRAW_PROCESS,
    ProcessWithdrawReqID: parseInt(String(1e7 * Math.random()), 10),
    WithdrawID,
    Action,
  }
  if (reasonId) {
    msg.ReasonID = reasonId
  }
  if (reason) {
    msg.Reason = reason
  }
  if (data) {
    msg.Data = data
  }
  if (percentFee) {
    msg.PercentFee = percentFee
  }
  if (fixedFee) {
    msg.FixedFee = fixedFee
  }
  return this.blinktrade.send(msg)
}

const blinktrade = new BlinkTradeWS({
  prod: false,
  brokerId: 4,
})

function fetchWithdraws({ page = 0, statusList }) {
  return this.blinktrade.requestWithdrawList({
    page,
    pageSize: 20,
    statusList,
  }).then(data => {
    this.withdraws.push(...data.WithdrawListGrp)
    console.log(`${statusList} Pesquisando PÃ¡gina: ${page} Total: ${this.withdraws.length} Saques`)
    return data.WithdrawListGrp.length > 0
      ? this.fetchWithdraws({ page: page + 1, statusList })
      : this.promptWithdrawId()
  })
}

console.log('hey')
